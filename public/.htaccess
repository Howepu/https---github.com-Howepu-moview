# Включение модуля заголовков
<IfModule mod_headers.c>
    # Кеширование статических ресурсов
    
    # Изображения - 1 год
    <FilesMatch "\.(jpg|jpeg|png|gif|webp|ico|svg)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>
    
    # CSS и JavaScript - 1 год (с версионированием)
    <FilesMatch "\.(css|js)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>
    
    # Шрифты - 1 год
    <FilesMatch "\.(woff|woff2|ttf|otf|eot)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>
    
    # HTML - короткое кеширование
    <FilesMatch "\.(html|htm)$">
        Header set Cache-Control "public, max-age=3600, must-revalidate"
    </FilesMatch>
    
    # PHP страницы - не кешировать (динамический контент)
    <FilesMatch "\.php$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires 0
    </FilesMatch>
</IfModule>

# Сжатие контента
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Настройка редиректов и обработки ошибок
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # Принудительный HTTPS (совместимо с Render/прокси)
    # Проверяем X-Forwarded-Proto для работы за load balancer
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    
    # Редирект www на non-www (или наоборот - выбрать один вариант)
    RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
    RewriteRule ^(.*)$ https://%1/$1 [R=301,L]
    
    # Редирект с index.php на main.php
    RewriteRule ^index\.php$ main.php [R=301,L]
    
    # Семантические URI для страниц
    
    # Главная страница: / → main.php
    RewriteRule ^$ main.php [L]
    
    # Страница фильма: /film/123.html → film_page.php?id=123
    RewriteRule ^film/([0-9]+)\.html$ film_page.php?id=$1 [L,QSA]
    
    # Страница жанра: /genre/5.html → films_by_genres.php?genre_id=5
    RewriteRule ^genre/([0-9]+)\.html$ films_by_genres.php?genre_id=$1 [L,QSA]
    
    # Страница режиссёра: /director/10.html → films_by_directors.php?director_id=10
    RewriteRule ^director/([0-9]+)\.html$ films_by_directors.php?director_id=$1 [L,QSA]
    
    # Список всех фильмов: /films.html → films.php
    RewriteRule ^films\.html$ films.php [L,QSA]
    
    # Список всех жанров: /genres.html → genres.php
    RewriteRule ^genres\.html$ genres.php [L,QSA]
    
    # Список всех режиссёров: /directors.html → directors.php
    RewriteRule ^directors\.html$ directors.php [L,QSA]
    
    # Поиск: /search.html → search.php
    RewriteRule ^search\.html$ search.php [L,QSA]
    
    # Помощь: /help.html → help.php
    RewriteRule ^help\.html$ help.php [L,QSA]
    
    # Обработка 404 ошибок
    ErrorDocument 404 /errors/404.php
    ErrorDocument 403 /errors/403.php
</IfModule>
